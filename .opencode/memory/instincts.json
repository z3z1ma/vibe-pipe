{
  "version": 1,
  "instincts": [
    {
      "id": "verify-code-before-closing-tickets",
      "title": "Verify code exists before closing completed tickets",
      "trigger": "Ticket marked 'ready to merge' or 'implementation complete'",
      "action": "Use glob/read to verify actual code files exist in codebase before closing the ticket. Look for expected file paths (e.g., src/vibe_piper/connectors/*.py for database connector tickets)",
      "tags": [],
      "confidence": 0.7,
      "status": "active",
      "created_at": "2026-01-29T10:20:06.338Z",
      "updated_at": "2026-01-29T10:20:06.338Z",
      "evidence": [
        {
          "ts": "2026-01-29T10:20:06.338Z",
          "sessionID": "ses_3f6c7f020ffeQih6L1ac9Qpcwz"
        }
      ]
    },
    {
      "id": "check-loom-permissions-early",
      "title": "Check Loom command permissions before acting as Team Manager",
      "trigger": "Acting as Team Manager for Loom team",
      "action": "Verify permission rules allow `loom team *` commands early. If only `loom ticket *` is allowed, document blocker immediately and proceed with ticket-only workflow.",
      "tags": [],
      "confidence": 0.8,
      "status": "active",
      "created_at": "2026-01-29T10:20:06.338Z",
      "updated_at": "2026-01-29T10:20:06.338Z",
      "evidence": [
        {
          "ts": "2026-01-29T10:20:06.338Z",
          "sessionID": "ses_3f6c7f020ffeQih6L1ac9Qpcwz"
        }
      ]
    },
    {
      "id": "sync-ticket-updates",
      "title": "Sync ticket updates after modifications",
      "trigger": "After any `loom ticket` command that changes state (close, add-note, update)",
      "action": "Run `loom ticket sync` to commit ticket changes to repository",
      "tags": [],
      "confidence": 0.9,
      "status": "active",
      "created_at": "2026-01-29T10:20:06.338Z",
      "updated_at": "2026-01-29T10:20:06.338Z",
      "evidence": [
        {
          "ts": "2026-01-29T10:20:06.338Z",
          "sessionID": "ses_3f6c7f020ffeQih6L1ac9Qpcwz"
        }
      ]
    },
    {
      "id": "loom-manager-add-ticket-notes",
      "title": "Add detailed notes when creating tickets",
      "trigger": "Created new ticket via loom ticket create",
      "action": "Immediately add a note to the ticket with: 1) Tasks numbered list, 2) Dependencies (if any), 3) Acceptance criteria, 4) Technical notes, 5) Example usage (if feature)",
      "tags": [],
      "confidence": 0.8,
      "status": "active",
      "created_at": "2026-01-29T10:20:56.342Z",
      "updated_at": "2026-01-29T10:20:56.342Z",
      "evidence": [
        {
          "ts": "2026-01-29T10:20:56.342Z",
          "sessionID": "ses_3f6cb10cdffefQ8XTkC2OcKXcv"
        }
      ]
    },
    {
      "id": "loom-manager-check-merge-blockage",
      "title": "Check for complete-but-unmerged tickets",
      "trigger": "Listing tickets shows in_progress status but implementation is complete",
      "action": "For each in_progress ticket: check if implementation is done (git log shows recent feature commits, ticket notes say 'implementation complete'), if yes but not merged: add URGENT note with commit hash and branch name, request merge to merge-queue",
      "tags": [],
      "confidence": 0.7,
      "status": "active",
      "created_at": "2026-01-29T10:20:56.342Z",
      "updated_at": "2026-01-29T10:20:56.342Z",
      "evidence": [
        {
          "ts": "2026-01-29T10:20:56.342Z",
          "sessionID": "ses_3f6cb10cdffefQ8XTkC2OcKXcv"
        }
      ]
    },
    {
      "id": "loom-manager-dependency-notes",
      "title": "Document ticket dependencies in notes",
      "trigger": "Starting work on a ticket that depends on others or creating a ticket that other tickets will depend on",
      "action": "Add a note starting with 'DEPENDENCIES:' listing all ticket IDs this ticket depends on, with brief explanation of relationship and priority guidance (when to work on this)",
      "tags": [],
      "confidence": 0.75,
      "status": "active",
      "created_at": "2026-01-29T10:20:56.342Z",
      "updated_at": "2026-01-29T10:20:56.342Z",
      "evidence": [
        {
          "ts": "2026-01-29T10:20:56.342Z",
          "sessionID": "ses_3f6cb10cdffefQ8XTkC2OcKXcv"
        }
      ]
    },
    {
      "id": "loom-manager-inspect-before-action",
      "title": "Inspect git state before ticket actions",
      "trigger": "About to merge a ticket branch or assess completion status",
      "action": "Run git log <branch> --oneline -5 to see recent commits, git diff main <branch> --stat to see change scope, check if commits look like implementation vs cleanup, verify branch exists and is ahead of main",
      "tags": [],
      "confidence": 0.65,
      "status": "active",
      "created_at": "2026-01-29T10:20:56.342Z",
      "updated_at": "2026-01-29T10:20:56.342Z",
      "evidence": [
        {
          "ts": "2026-01-29T10:20:56.342Z",
          "sessionID": "ses_3f6cb10cdffefQ8XTkC2OcKXcv"
        }
      ]
    },
    {
      "id": "loom-manager-phase-organization",
      "title": "Organize tickets by phase in tags",
      "trigger": "Creating tickets for sequential project phases",
      "action": "Add phase tags (phase1, phase2, phase3) to tickets and ensure lower-priority tickets have dependency notes referencing higher-priority phase tickets that must complete first",
      "tags": [],
      "confidence": 0.7,
      "status": "active",
      "created_at": "2026-01-29T10:20:56.342Z",
      "updated_at": "2026-01-29T10:20:56.342Z",
      "evidence": [
        {
          "ts": "2026-01-29T10:20:56.342Z",
          "sessionID": "ses_3f6cb10cdffefQ8XTkC2OcKXcv"
        }
      ]
    },
    {
      "id": "verify-code-before-ticket-close",
      "title": "Verify code exists before closing tickets",
      "trigger": "Worker marks ticket ready for review/merge",
      "action": "Before closing ticket, use glob to verify expected code files exist in codebase (e.g., src/vibe_piper/connectors/*.py for database connector tickets). This prevents closing tickets where implementation notes exist but no actual code was committed.",
      "tags": [],
      "confidence": 0.85,
      "status": "active",
      "created_at": "2026-01-29T12:18:15.165Z",
      "updated_at": "2026-01-29T12:18:15.165Z",
      "evidence": [
        {
          "ts": "2026-01-29T12:18:15.165Z",
          "sessionID": "ses_3f6c5ab2bffemqV19OsZcMHJSo"
        }
      ]
    },
    {
      "id": "merge-worker-workspace-cleanup",
      "title": "Handle git workspace cleanup failures",
      "trigger": "Attempting to retire worker after merge",
      "action": "When 'loom team retire <worker>' fails with 'modified or untracked files' error, check worktree status with git status and either: 1) Stash uncommitted changes, 2) Use --force flag if safe to delete, or 3) Manually clean up files before retrying retirement.",
      "tags": [],
      "confidence": 0.8,
      "status": "active",
      "created_at": "2026-01-29T12:18:15.165Z",
      "updated_at": "2026-01-29T12:18:15.165Z",
      "evidence": [
        {
          "ts": "2026-01-29T12:18:15.165Z",
          "sessionID": "ses_3f6c5ab2bffemqV19OsZcMHJSo"
        }
      ]
    },
    {
      "id": "phase3-ticket-sequencing",
      "title": "Phase 3 P1 tickets depend on orchestration engine",
      "trigger": "Starting Phase 3 ticket implementation",
      "action": "Orchestration Engine (vp-cf95) must complete before CLI (vp-6cf1), Scheduling (vp-7d49), and Monitoring (vp-f17e) can fully integrate. Verify orchestration engine is in codebase before spawning workers for dependent tickets.",
      "tags": [],
      "confidence": 0.9,
      "status": "active",
      "created_at": "2026-01-29T12:18:15.165Z",
      "updated_at": "2026-01-29T12:18:15.165Z",
      "evidence": [
        {
          "ts": "2026-01-29T12:18:15.165Z",
          "sessionID": "ses_3f6c5ab2bffemqV19OsZcMHJSo"
        }
      ]
    },
    {
      "id": "optional-dependency-import-pattern",
      "title": "Import optional dependencies with try/except and type ignore",
      "trigger": "Need to use external library that may not be installed",
      "action": "1. Wrap import in try/except block\n2. Add type: ignore[import-untyped] comment for mypy\n3. Set flag variable to track availability\n4. Provide fallback behavior when unavailable\n5. Document degradation in docstring",
      "tags": [],
      "confidence": 0.9,
      "status": "active",
      "created_at": "2026-01-29T11:00:04.777Z",
      "updated_at": "2026-01-29T11:00:04.777Z",
      "evidence": [
        {
          "ts": "2026-01-29T11:00:04.777Z",
          "sessionID": "ses_3f6af2e3dffeEkpZIw2vpvKPE0"
        }
      ]
    },
    {
      "id": "datetime-none-coalescing",
      "title": "Coalesce None datetime values before arithmetic",
      "trigger": "Performing datetime arithmetic with potentially None fields",
      "action": "Always use: (field or datetime.utcnow()) to ensure arithmetic operations have datetime, not Optional[datetime]",
      "tags": [],
      "confidence": 0.85,
      "status": "active",
      "created_at": "2026-01-29T11:00:04.777Z",
      "updated_at": "2026-01-29T11:00:04.777Z",
      "evidence": [
        {
          "ts": "2026-01-29T11:00:04.777Z",
          "sessionID": "ses_3f6af2e3dffeEkpZIw2vpvKPE0"
        }
      ]
    },
    {
      "id": "formatter-type-separation",
      "title": "Use separate variables for different formatter types",
      "trigger": "MyPy complains about incompatible formatter assignments",
      "action": "Create distinct variables (json_formatter, colored_formatter, simple_formatter) instead of reusing single 'formatter' variable to avoid type checker confusion",
      "tags": [],
      "confidence": 0.75,
      "status": "active",
      "created_at": "2026-01-29T11:00:04.777Z",
      "updated_at": "2026-01-29T11:00:04.777Z",
      "evidence": [
        {
          "ts": "2026-01-29T11:00:04.777Z",
          "sessionID": "ses_3f6af2e3dffeEkpZIw2vpvKPE0"
        }
      ]
    },
    {
      "id": "pandas-string-accessor-pattern",
      "title": "Use Series.str accessor for text operations on DataFrames",
      "trigger": "Applying string methods (trim, upper, lower, title) to pandas DataFrame columns",
      "action": "Always use df[col].str.method() for column operations, never operate on individual strings. The Series.str accessor returns a StringMethods object that operates on the entire series efficiently.",
      "tags": [],
      "confidence": 0.9,
      "status": "active",
      "created_at": "2026-01-29T22:42:09.139Z",
      "updated_at": "2026-01-29T22:42:09.139Z",
      "evidence": [
        {
          "ts": "2026-01-29T22:42:09.139Z",
          "sessionID": "ses_3f421a2b6ffeHWqQsWf7wdrUWl"
        }
      ]
    },
    {
      "id": "nullable-schema-fields-for-tests",
      "title": "Mark schema fields nullable when test data contains None values",
      "trigger": "Creating test fixtures with DataRecord objects that have null values in specific fields",
      "action": "Set nullable=True on SchemaField definitions for any field that may contain None in test data. DataRecord.__post_init__ raises ValueError if a non-nullable field contains None.",
      "tags": [],
      "confidence": 0.95,
      "status": "active",
      "created_at": "2026-01-29T22:42:09.139Z",
      "updated_at": "2026-01-29T22:42:09.139Z",
      "evidence": [
        {
          "ts": "2026-01-29T22:42:09.139Z",
          "sessionID": "ses_3f421a2b6ffeHWqQsWf7wdrUWl"
        }
      ]
    },
    {
      "id": "float-to-int-outlier-replacement",
      "title": "Handle float-to-int type conversion when replacing outliers",
      "trigger": "Replacing outliers with mean/median (always float) into integer columns",
      "action": "Either use .astype(float) on the column before replacement to allow float values, or cast mean_val to int explicitly using int(mean_val) when the target column is integer type.",
      "tags": [],
      "confidence": 0.85,
      "status": "active",
      "created_at": "2026-01-29T22:42:09.139Z",
      "updated_at": "2026-01-29T22:42:09.139Z",
      "evidence": [
        {
          "ts": "2026-01-29T22:42:09.139Z",
          "sessionID": "ses_3f421a2b6ffeHWqQsWf7wdrUWl"
        }
      ]
    },
    {
      "id": "export-new-transformation-modules",
      "title": "Update transformations/__init__.py exports for new transformation modules",
      "trigger": "Creating new transformation modules (aggregations, cleaning, windows, etc.)",
      "action": "Immediately update src/vibe_piper/transformations/__init__.py to include __all__ exports from the new module with descriptive docstring categories (e.g., # Cleaning, # Aggregations).",
      "tags": [],
      "confidence": 0.9,
      "status": "active",
      "created_at": "2026-01-29T22:42:09.139Z",
      "updated_at": "2026-01-29T22:42:09.139Z",
      "evidence": [
        {
          "ts": "2026-01-29T22:42:09.139Z",
          "sessionID": "ses_3f421a2b6ffeHWqQsWf7wdrUWl"
        }
      ]
    },
    {
      "id": "sklearn-max-samples-auto",
      "title": "Use 'auto' for Isolation Forest max_samples",
      "trigger": "Using sklearn.ensemble.IsolationForest",
      "action": "Set max_samples='auto' instead of None (scikit-learn v1.5+ requires explicit value)",
      "tags": [],
      "confidence": 0.9,
      "status": "active",
      "created_at": "2026-01-29T22:43:46.406Z",
      "updated_at": "2026-01-29T22:43:46.406Z",
      "evidence": [
        {
          "ts": "2026-01-29T22:43:46.406Z",
          "sessionID": "ses_3f423cae8ffedZgcPcG4PJXQmF"
        }
      ]
    },
    {
      "id": "nullable-schema-test-fixture",
      "title": "Create nullable schemas for null testing",
      "trigger": "Testing null handling in DataRecords",
      "action": "Define SchemaField with nullable=True when fixture may contain None values to avoid DataRecord validation errors",
      "tags": [],
      "confidence": 0.85,
      "status": "active",
      "created_at": "2026-01-29T22:43:46.406Z",
      "updated_at": "2026-01-29T22:43:46.406Z",
      "evidence": [
        {
          "ts": "2026-01-29T22:43:46.406Z",
          "sessionID": "ses_3f423cae8ffedZgcPcG4PJXQmF"
        }
      ]
    },
    {
      "id": "optional-dependency-type-ignore",
      "title": "Add type: ignore[import-untyped] for optional sklearn/numpy",
      "trigger": "Importing sklearn or numpy with try/except for optional dependency",
      "action": "Include '# type: ignore[import-untyped]' on import statement to satisfy mypy strict mode while allowing graceful degradation",
      "tags": [],
      "confidence": 0.85,
      "status": "active",
      "created_at": "2026-01-29T22:43:46.406Z",
      "updated_at": "2026-01-29T22:43:46.406Z",
      "evidence": [
        {
          "ts": "2026-01-29T22:43:46.406Z",
          "sessionID": "ses_3f423cae8ffedZgcPcG4PJXQmF"
        }
      ]
    },
    {
      "id": "expectation-validationresult-return",
      "title": "Expectation functions return ValidationResult",
      "trigger": "Creating validation expectation for @validate decorator",
      "action": "Ensure custom validation functions return ValidationResult(is_valid=..., errors=(...)) for compatibility with ValidationConfig.checks",
      "tags": [],
      "confidence": 0.9,
      "status": "active",
      "created_at": "2026-01-29T22:43:46.406Z",
      "updated_at": "2026-01-29T22:43:46.406Z",
      "evidence": [
        {
          "ts": "2026-01-29T22:43:46.406Z",
          "sessionID": "ses_3f423cae8ffedZgcPcG4PJXQmF"
        }
      ]
    },
    {
      "id": "drift-baseline-storage-json",
      "title": "Store drift baselines as JSON with metadata",
      "trigger": "implementing drift detection with historical comparison",
      "action": "save baseline data to JSON file with metadata (timestamp, sample_size, columns, schema_name) for efficient retrieval",
      "tags": [],
      "confidence": 0.8,
      "status": "active",
      "created_at": "2026-01-29T22:49:51.481Z",
      "updated_at": "2026-01-29T22:49:51.481Z",
      "evidence": [
        {
          "ts": "2026-01-29T22:49:51.481Z",
          "sessionID": "ses_3f423bbacffeOy5Uj6zfY1jYce"
        }
      ]
    },
    {
      "id": "drift-threshold-validation",
      "title": "Validate drift thresholds on configuration",
      "trigger": "creating DriftThresholds configuration class",
      "action": "validate that warning < critical, all thresholds in [0,1] range, and warning < psi_critical, with clear error messages",
      "tags": [],
      "confidence": 0.75,
      "status": "active",
      "created_at": "2026-01-29T22:49:51.481Z",
      "updated_at": "2026-01-29T22:49:51.481Z",
      "evidence": [
        {
          "ts": "2026-01-29T22:49:51.481Z",
          "sessionID": "ses_3f423bbacffeOy5Uj6zfY1jYce"
        }
      ]
    },
    {
      "id": "drift-history-timestamp-tracking",
      "title": "Track drift results with timestamps for trend analysis",
      "trigger": "implementing DriftHistory class for drift monitoring",
      "action": "store each drift check with timestamp, baseline_id, method, drift_score, and alert_level to enable temporal trend analysis",
      "tags": [],
      "confidence": 0.85,
      "status": "active",
      "created_at": "2026-01-29T22:49:51.481Z",
      "updated_at": "2026-01-29T22:49:51.481Z",
      "evidence": [
        {
          "ts": "2026-01-29T22:49:51.481Z",
          "sessionID": "ses_3f423bbacffeOy5Uj6zfY1jYce"
        }
      ]
    },
    {
      "id": "validation-result-wrapper-pattern",
      "title": "Wrap drift functions to return ValidationResult for @validate",
      "trigger": "creating check_drift_ks and check_drift_psi functions",
      "action": "map drift detection results to ValidationResult: is_valid=(alert_level != 'critical'), errors=list for critical, warnings=list for recommendations and drifted columns",
      "tags": [],
      "confidence": 0.8,
      "status": "active",
      "created_at": "2026-01-29T22:49:51.481Z",
      "updated_at": "2026-01-29T22:49:51.481Z",
      "evidence": [
        {
          "ts": "2026-01-29T22:49:51.481Z",
          "sessionID": "ses_3f423bbacffeOy5Uj6zfY1jYce"
        }
      ]
    },
    {
      "id": "optional-scipy-type-checking",
      "title": "Use TYPE_CHECKING for optional scipy.stats import",
      "trigger": "importing scipy.stats for KS/PSI/chi-square tests",
      "action": "import scipy inside function body with TYPE_CHECKING guard to prevent ImportError when scipy is not installed, keep import localized",
      "tags": [],
      "confidence": 0.9,
      "status": "active",
      "created_at": "2026-01-29T22:49:51.481Z",
      "updated_at": "2026-01-29T22:49:51.481Z",
      "evidence": [
        {
          "ts": "2026-01-29T22:49:51.481Z",
          "sessionID": "ses_3f423bbacffeOy5Uj6zfY1jYce"
        }
      ]
    },
    {
      "id": "statistical-test-min-samples",
      "title": "Validate minimum sample size before running statistical drift tests",
      "trigger": "calling detect_drift_ks, detect_drift_psi, or detect_drift_chi_square",
      "action": "check that both baseline and new data have at least min_samples (default 50) before running test, return DriftResult with error message if insufficient",
      "tags": [],
      "confidence": 0.85,
      "status": "active",
      "created_at": "2026-01-29T22:49:51.481Z",
      "updated_at": "2026-01-29T22:49:51.481Z",
      "evidence": [
        {
          "ts": "2026-01-29T22:49:51.481Z",
          "sessionID": "ses_3f423bbacffeOy5Uj6zfY1jYce"
        }
      ]
    },
    {
      "id": "datarecord-fixture-schema",
      "title": "Create DataRecord fixtures with proper schema",
      "trigger": "writing pytest fixtures for drift detection tests",
      "action": "define schema fixtures with proper SchemaFields and DataType enums, use schema parameter when creating DataRecord instances",
      "tags": [],
      "confidence": 0.75,
      "status": "active",
      "created_at": "2026-01-29T22:49:51.481Z",
      "updated_at": "2026-01-29T22:49:51.481Z",
      "evidence": [
        {
          "ts": "2026-01-29T22:49:51.481Z",
          "sessionID": "ses_3f423bbacffeOy5Uj6zfY1jYce"
        }
      ]
    }
  ]
}
