---
"id": "vp-f701"
"status": "in_progress"
"deps": []
"links": []
"created": "2026-01-30T04:08:39Z"
"type": "feature"
"priority": 1
"assignee": "z3z1ma"
"tags":
- "sprint:Phase-1-foundations-config-pipelines-har"
- "phase1"
- "implementation"
- "schema"
"external": {}
---
# Schema-first mapping (source_path + conversions)

Goal: Implement schema-first field mapping with `source_path` annotation to eliminate manual field extraction and type conversion.

Requirements:
1) `SchemaField.source_path` supports dot + bracket syntax (e.g., `company.name`, `tags[0]`, `data.items[0].name`).
2) Auto-mapping extracts values from nested structures; missing paths return `None` (log warning).
3) Auto-type conversion for `DATETIME`/`DATE`/`INTEGER`/`FLOAT`/`BOOLEAN`; invalid conversions produce clear errors; preserve timezone for `DATETIME`.
4) Field mapper utility maps a source record into a schema-typed record with validation and error collection.

Expected files:
- `src/vibe_piper/schema/__init__.py`
- `src/vibe_piper/schema/mapping.py`
- `src/vibe_piper/schema/field_mapper.py`
- `src/vibe_piper/types.py` (`SchemaField.source_path`)
- `tests/schema/test_mapping.py`
- `tests/schema/test_field_mapper.py`

Acceptance criteria:
- `source_path` annotation works for nested dicts + arrays
- Missing path handling returns `None` + warning
- Type conversion works for datetime/date/int/float/bool
- Required vs nullable field validation correct
- Tests cover core cases and edge cases (incl. errors)
- Documentation for `source_path` syntax

References:
- `docs/investigation_missing_abstractions.md` section 2.1.B
- `examples/api_ingestion/pipeline.py` (field extraction patterns)
