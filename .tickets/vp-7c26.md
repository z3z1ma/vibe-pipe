---
"id": "vp-7c26"
"status": "in_progress"
"deps": []
"links": []
"created": "2026-01-30T05:03:33Z"
"type": "feature"
"priority": 1
"assignee": "z3z1ma"
"tags":
- "phase2"
- "implementation"
- "transformations"
"external": {}
---
# Implement Transformation Library - Fluent API

Implement declarative transformation library with fluent, composable API to replace manual transformation code.

Based on investigation (vp-5299), Phase 2 needs:

Transformation Library to implement:
1. **Fluent Pipeline API** - Chainable transformation operations:
   - pipe() method to chain operations
   - filter() for filtering rows
   - map() for transforming fields
   - aggregate() for group-by operations
   - join() for joining datasets
   - validate() for schema validation
   - Type-safe operations with schema awareness

2. **Built-in Transformations** - Reusable transformation functions:
   - extract_fields() - Extract nested fields from source
   - map_field() - Map/transform individual fields
   - compute_field() - Add computed/calculated fields
   - filter_rows() - Filter by condition
   - enrich_from_lookup() - Join with lookup table/reference data
   - group_by() - Aggregate by columns
   - pivot() - Wide-to-long transformation
   - unpivot() - Long-to-wide transformation

3. **Type Safety** - Schema-aware transformations:
   - Input schema validation
   - Output schema inference
   - Type hints throughout
   - Compile-time type checking with mypy

4. **Integration Points**:
   - Works with Source abstractions (APISource, DatabaseSource, FileSource)
   - Works with Sink abstractions (DatabaseSink, FileSink)
   - Integrates with @asset decorator
   - Returns lazy sequences for memory efficiency

Expected files:
- src/vibe_piper/transformations/__init__.py
- src/vibe_piper/transformations/pipeline.py (fluent API)
- src/vibe_piper/transformations/transforms.py (built-in transformations)
- src/vibe_piper/transformations/validators.py (validation helpers)
- tests/transformations/test_pipeline.py
- tests/transformations/test_transforms.py
- docs/transformations.md (API reference and examples)

Acceptance Criteria:
- Fluent chainable API working (pipe().filter().map()...)
- At least 8 built-in transformations implemented
- All transformations are type-safe with schema support
- Lazy sequence support for memory efficiency
- Integration with @asset decorator working
- Comprehensive test coverage (80%+)
- Documentation for each transformation
- Example demonstrating reduction from manual transforms to fluent API

Success Metrics (from investigation):
- Code reduction: 85%+ for transformations (from 40+ lines to ~5 lines)
- Reusable transformation library
- Composable operations
- Type-safe throughout

Reference:
- Original manual code in examples/api_ingestion/pipeline.py lines 295-323 (manual validation)
- Investigator design in docs/investigation_missing_abstractions.md section 2.C
